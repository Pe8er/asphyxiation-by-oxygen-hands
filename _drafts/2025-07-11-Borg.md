---
title: I have finally set up backups
date: 2025-07-11
categories:
  - Blog
tags: [Homelab]
toc: true
header:
  teaser: /assets/images/g3.jpg
---

## Installation

```bash
sudo apt update
sudo apt install pipx
sudo pipx ensurepath
sudo apt install borgbackup
sudo pipx install borgmatic
```

Check if it's installed:

```bash
sudo su -
borgmatic --version
```

Add /root/.local/bin to sudoers:

```bash
sudo visudo
```

Find "secure_path" line and add at the end:

```bash
:/root/.local/bin
```

## Configuration

Generate the config file:

```bash
sudo borgmatic config generate --destination ~/.config/borgmatic/config.yaml
```

I don't know why borgmatic didn't pick up on the custom `--destination`, so I had to fix it, caveman-style:

```bash
sudo mkdir /etc/borgmatic
sudo ln -s ~/.config/borgmatic/config.yaml /etc/borgmatic/config.yaml
```

Here's the excerpt of my config:

```yaml
source_directories:
    - /home/pe8er
    - /mnt/ssd-sandisk
repositories:
	- path: /mnt/media/borgbackups
	  label: g3-backup
	  encryption: none
exclude_patterns:
	- /home/pe8er/.cache
    - /home/pe8er/Downloads
    - /home/pe8er/Movies
    - /home/pe8er/TV
    - /home/pe8er/snap
    - '*/*tmp'
    - '*/log'
    - '*/*.log'

keep_daily: 7
keep_weekly: 4
keep_monthly: 3
```

Holy shit, the way keep_* options are designed is absolutely beyond my comprehension.

Validate config:

````bash
sudo borgmatic config validate
````

## Launch the Borg!!!

```bash
sudo borgmatic create --verbosity 1 --list --stats
```

Oh damn it works! And it's pretty damn fast.

```bash
g3-backup: Pruning archives
Keeping archive (rule: daily #1):            g3-2025-07-11T14:50:55.642919        Fri, 2025-07-11 14:50:55 [1678cb92d646bca4a8912c4479ab9d96a9f3c38f81e8a26bdbcd79dbdd2f95cd]
Pruning archive (1/1):                       g3-2025-07-11T14:49:49.867765        Fri, 2025-07-11 14:49:50 [35cef225b9c6a0bcf06fb4c228166e158f3f602f6cf6bf300dbd14fe827fdeeb]
Keeping archive (rule: daily[oldest] #2):    g3-2025-07-11T10:43:31.991167        Fri, 2025-07-11 10:43:32 [9248f2607a766f9bbb686173cdc1ae59df100cc54ec8155f16e1fffb4516e9d1]
------------------------------------------------------------------------------
                       Original size      Compressed size    Deduplicated size
Deleted data:             -738.30 GB           -715.41 GB             -4.71 MB
All archives:                1.48 TB              1.43 TB            642.51 GB
                       Unique chunks         Total chunks
Chunk index:                  364881               831003
------------------------------------------------------------------------------
g3-backup: Compacting segments
compaction freed about 4.71 MB repository space.
g3-backup: Running consistency checks
g3-backup: Skipping repository check due to configured frequency; 29 days, 22:33:44.729506 until next check (use --force to check anyway)
g3-backup: Skipping archives check due to configured frequency; 29 days, 22:33:44.728086 until next check (use --force to check anyway)

summary:
/etc/borgmatic/config.yaml: Successfully ran configuration file
```

## Automation

something

## Browsing and Restoring Files

something
